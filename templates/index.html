{% extends 'base.html' %}
{% block content %}
<h1>Kanban Board</h1>
<form method="POST" action="{{ url_for('add_list') }}" class="mb-4">
  {{ list_form.hidden_tag() }}
  <div class="input-group">
    {{ list_form.name(class="form-control", placeholder="New list name") }}
    <button type="submit" class="btn btn-primary">{{ list_form.submit.label.text }}</button>
  </div>
</form>
<div class="board">
    {% for list in lists %}
    {% if list.name != 'deleted_task' %}
    <!-- Render list -->
    <div class="list" style="background-color: {{ list.color }};" id="list-{{ list.id }}">
        <div class="list-header" data-list-id="{{ list.id }}">
        <div class="list-title d-flex justify-content-between align-items-center">
            <span class="list-name">{{ list.name }}</span>
            <button class="edit-icon btn btn-sm btn-link p-0" title="Rename list">
            âœï¸
            </button>
        </div>

        <form method="POST" action="{{ url_for('edit_list_name', list_id=list.id) }}" class="edit-list-form d-none mt-2">
            {{ edit_form.hidden_tag() }}
            <input type="text" name="name" class="form-control form-control-sm" value="{{ list.name }}" required>
        </form>
        </div>

        <!-- âœ… Draggable zone only -->
        <div class="card-zone">
            <div class="card-container" id="cards-{{ list.id }}">
                {% for card in list.cards %}
                <div class="card" data-card-id="{{ card.id }}">
                    <h3>{{ card.title }}</h3>
                    <p>{{ card.description }}</p>
                    <form method="POST" action="{{ url_for('delete_card', card_id=card.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete card" onclick="return confirm('Move this card to deleted tasks?');">ğŸ—‘ï¸</button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- âœ… Form stays outside the draggable zone -->
        <form class="add-card-form" data-list-id="{{ list.id }}">
            {{ form.hidden_tag() }}
            <div>{{ form.title(size=30) }}</div>
            <div>{{ form.description(rows=2, cols=30) }}</div>
            <div><button type="submit">Add Card</button></div>
        </form>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% endblock %}